<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Kill Team Planner</title>
<style>
body { margin:0; font-family:sans-serif; }
#toolbar {
  height:50px; background:#222; display:flex; align-items:center; padding:5px; gap:5px;
}
#toolbar button, #toolbar select { padding:5px 10px; font-size:14px; cursor:pointer; }



.token {
  position: absolute;  /* Para poder moverla */
  z-index: 10;         /* Encima del mapa y la cuadrÃ­cula */
  border-radius: 50%;  /* Circular */
  cursor: grab;        /* Para que se vea movible */
  background-color: gray; /* Color temporal si quieres probar */
}

.token.blue { background-color: blue; }
.token.red  { background-color: red; }

.token, .objective, .line { position:absolute; z-index:10; }
.token { border-radius:50%; cursor:grab; }
.objective {
  width:24px; height:24px; border-radius:50%; background:orange; color:black;
  text-align:center; font-weight:bold; line-height:24px; cursor:grab; user-select:none;
}
.line { width:2px; background:red; }

  /* ===== LAYOUT MAPA ===== */

#app {
  height: 100vh;
  display: flex;
  flex-direction: column;
}

#toolbar {
  height: 60px;
  background: #2b6cff;
  color: white;

  display: flex;
  justify-content: center;   /* ðŸ‘ˆ centra horizontal */
  align-items: center;       /* ðŸ‘ˆ centra vertical */

  gap: 15px;                 /* espacio entre botones */
}

#toolbar button {
  background: white;
  color: #2b6cff;
  border: none;
  padding: 6px 14px;
  font-weight: 600;
  border-radius: 4px;
  cursor: pointer;
}

#toolbar button:hover {
  background: #e6e6e6;
}



#main {
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  background: #888;
}

  #board {
  position: relative;
  background-color: #111;
  background-image: url("mapa1.jpg");
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
}

#board::after {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 2;

  background-image:
    linear-gradient(to right, rgba(255,255,255,0.15) 1px, transparent 1px),
    linear-gradient(to bottom, rgba(255,255,255,0.15) 1px, transparent 1px);

  background-size: var(--cell) var(--cell);
}

#leftPanel,
#rightPanel {
  width: 120px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
}

.palette {
  border-radius: 50%;
  cursor: grab;
  opacity: 0.9;
}
 
</style>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>
<body>
<div id="app">

  <div id="toolbar">
     
  <button id="moveBtn">Mover</button>
  <button id="drawBtn">Flecha</button>
  <button id="eraseBtn">Borrar</button>
  <button id="objectiveBtn">Objetivo</button>
  <button id="exportBtn">Exportar</button>
  </div>

  <div id="main">
  <div id="leftPanel"></div>
  <div id="board"></div>
  <div id="rightPanel"></div>
</div>

</div>

<script>

  document.addEventListener('DOMContentLoaded', () => {
  
  const board = document.getElementById('board');
  const toolbarHeight = 50; // ajusta si tienes barra de herramientas
  const screenHeight = window.innerHeight - toolbarHeight; // altura disponible

  let mode = 'move';
    // ===== GENERAR PALETAS LATERALES =====

const sizes = [25, 28, 32, 40];

function createPalette(side, color) {
  const panel = document.getElementById(side);

  sizes.forEach(mm => {
    const sizePx = mm * (window.pxPerInch / 25.4);

    const el = document.createElement('div');
    el.className = 'palette ' + color;
    el.style.width = sizePx + 'px';
    el.style.height = sizePx + 'px';
    el.style.background = color;

    el.dataset.size = mm;
    el.dataset.color = color;

    panel.appendChild(el);

    el.onmousedown = startCloneDrag;
  });
}
    let floatingToken = null;

function startCloneDrag(e) {
  const mm = parseFloat(e.target.dataset.size);
  const color = e.target.dataset.color;

  const sizePx = mm * (window.pxPerInch / 25.4);

  floatingToken = document.createElement('div');
  floatingToken.className = 'token ' + color;
  floatingToken.style.width = sizePx + 'px';
  floatingToken.style.height = sizePx + 'px';
  floatingToken.style.position = 'absolute';
  floatingToken.style.pointerEvents = 'none';
  document.body.appendChild(floatingToken);

  moveFloating(e);

  document.addEventListener('mousemove', moveFloating);
  document.addEventListener('mouseup', dropFloating);
}

function moveFloating(e) {
  if (!floatingToken) return;

  floatingToken.style.left = (e.clientX - floatingToken.offsetWidth / 2) + 'px';
  floatingToken.style.top  = (e.clientY - floatingToken.offsetHeight / 2) + 'px';
}

function dropFloating(e) {
  document.removeEventListener('mousemove', moveFloating);
  document.removeEventListener('mouseup', dropFloating);

  const board = document.getElementById('board');
  const rect = board.getBoundingClientRect();

  if (
    e.clientX >= rect.left &&
    e.clientX <= rect.right &&
    e.clientY >= rect.top &&
    e.clientY <= rect.bottom
  ) {
    floatingToken.style.left =
      (e.clientX - rect.left - floatingToken.offsetWidth / 2) + 'px';
    floatingToken.style.top =
      (e.clientY - rect.top - floatingToken.offsetHeight / 2) + 'px';

    floatingToken.style.pointerEvents = 'auto';
    board.appendChild(floatingToken);
    makeDraggable(floatingToken);
  } else {
    floatingToken.remove();
  }

  floatingToken = null;
}


  
  // Peanas en mm
  const sizesMM = { small:25, normal:28, large:32, huge:40 };
  // Escala aumentada: 1 pulgada = 50px
  const mmToPx = mm => mm * (window.pxPerInch / 25.4);

 

    

  // Hacer movible cualquier elemento
  function makeDraggable(el){
    el.onmousedown = e=>{
      e.preventDefault();
      let offsetX = e.clientX - el.offsetLeft;
      let offsetY = e.clientY - el.offsetTop;
      function moveHandler(e){
        el.style.left = (e.clientX - offsetX)+'px';
        el.style.top = (e.clientY - offsetY)+'px';
      }
      function upHandler(){
        document.removeEventListener('mousemove', moveHandler);
        document.removeEventListener('mouseup', upHandler);
      }
      document.addEventListener('mousemove', moveHandler);
      document.addEventListener('mouseup', upHandler);
    };
  }

  // Dibujar flechas
  let startX, startY, tempLine;
  board.onmousedown = e=>{
    if(mode==='draw'){
      startX=e.offsetX; startY=e.offsetY;
      tempLine=document.createElement('div');
      tempLine.className='line';
      tempLine.style.left=startX+'px';
      tempLine.style.top=startY+'px';
      tempLine.style.width='0px';
      tempLine.style.height='2px';
      board.appendChild(tempLine);
      board.onmousemove = drawMove;
      board.onmouseup = drawEnd;
    }
  };
  function drawMove(e){
    const width = Math.hypot(e.offsetX-startX, e.offsetY-startY);
    tempLine.style.width = width+'px';
    const angle = Math.atan2(e.offsetY-startY, e.offsetX-startX)*180/Math.PI;
    tempLine.style.transform = `rotate(${angle}deg)`;
    tempLine.style.transformOrigin = '0 0';
  }
  function drawEnd(e){
    board.onmousemove = null;
    board.onmouseup = null;
    tempLine = null;
    mode='move';
  }

  // Click tablero: objetivos o borrar
  board.onclick = e=>{
    if(mode==='objective'){
      const objective=document.createElement('div');
      objective.className='objective';
      objective.style.left = (e.offsetX-12)+'px';
      objective.style.top = (e.offsetY-12)+'px';
      objective.innerText = prompt("NÃºmero o letra del objetivo:","1") || "1";
      makeDraggable(objective);
      board.appendChild(objective);
      mode='move';
    }
    if(mode==='erase'){
      const el = e.target;
      if(el.classList.contains('token') || el.classList.contains('objective') || el.classList.contains('line')){
        el.remove();
      }
      mode='move';
    }
  };

 // ===== PASO 4: TAMAÃ‘O REAL DEL MAPA =====
  function resizeBoard() {
  const toolbar = document.getElementById('toolbar');
  const board = document.getElementById('board');

  if (!toolbar || !board) return;

  // Altura disponible real
  const availableHeight = window.innerHeight - toolbar.offsetHeight;

  // Horizontal: 30 pulgadas ancho
  const boardHeight = availableHeight * 0.95;
  const boardWidth  = boardHeight * (30 / 22.4);

  board.style.height = boardHeight + 'px';
  board.style.width  = boardWidth + 'px';

  // 1 pulgada real en pÃ­xeles
 window.pxPerInch = boardWidth / 30;


  board.style.setProperty('--cell', pxPerInch + 'px');
}


  window.addEventListener('load', resizeBoard);
    
  resizeBoard(); // ðŸ‘ˆ esto fuerza tamaÃ±o inmediato
  window.addEventListener('resize', resizeBoard);

  createPalette('leftPanel', 'blue');
  createPalette('rightPanel', 'red');


  
});
</script>


</body>
</html>
